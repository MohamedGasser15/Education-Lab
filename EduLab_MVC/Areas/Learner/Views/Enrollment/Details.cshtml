@* @using EduLab_Shared.DTOs.Enrollment
@model EnrollmentDto
@{
    ViewData["Title"] = "تفاصيل الدورة";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Enrollment")">دوراتي</a></li>
                    <li class="breadcrumb-item active" aria-current="page">@Model.CourseTitle</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <img src="@Model.CourseThumbnail" class="card-img-top" alt="@Model.CourseTitle" style="height: 300px; object-fit: cover;">
                <div class="card-body">
                    <h2 class="card-title">@Model.CourseTitle</h2>
                    <p class="text-muted">بواسطة: @Model.InstructorName</p>
                    <p class="card-text">@Model.CategoryName</p>

                    <div class="progress mb-4" style="height: 15px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: @Model.ProgressPercentage%;"
                             aria-valuenow="@Model.ProgressPercentage" aria-valuemin="0" aria-valuemax="100">
                            @Model.ProgressPercentage%
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button class="btn btn-primary btn-lg">استمر في التعلم</button>
                        <button class="btn btn-outline-secondary">تنزيل الشهادة</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>معلومات التسجيل</h5>
                </div>
                <div class="card-body">
                    <p><strong>تاريخ التسجيل:</strong> @Model.EnrolledAt.ToString("yyyy/MM/dd")</p>
                    <p><strong>المبلغ المدفوع:</strong> @Model.PaidAmount.ToString("C")</p>
                    <p>
                        <strong>الحالة:</strong>
                        <span class="badge bg-success">@Model.Status</span>
                    </p>

                    <div class="mt-3">
                        <button class="btn btn-outline-danger w-100" data-bs-toggle="modal" data-bs-target="#cancelModal">
                            إلغاء التسجيل
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cancel Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">إلغاء التسجيل</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>هل أنت متأكد من أنك تريد إلغاء التسجيل في هذه الدورة؟</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">تراجع</button>
                <button type="button" class="btn btn-danger" onclick="cancelEnrollment()">تأكيد الإلغاء</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function cancelEnrollment() {
            $.post('@Url.Action("Cancel", "Enrollment", new { id = Model.Id })', {
                __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
            })
            .done(function(response) {
                if (response.success) {
                    $('#cancelModal').modal('hide');
                    showToast('success', response.message);
                    setTimeout(function() {
                        window.location.href = '@Url.Action("Index")';
                    }, 2000);
                } else {
                    showToast('error', response.message);
                }
            })
            .fail(function() {
                showToast('error', 'حدث خطأ أثناء الإلغاء');
            });
        }

        function showToast(type, message) {
            // Implement toast notification
            alert(message);
        }
    </script>
} *@