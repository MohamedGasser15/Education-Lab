@using EduLab_MVC.Models.DTOs.Profile
@using System.Globalization
@model InstructorProfileDTO

@{
    ViewData["Title"] = "الملف الشخصي للمدرب";
}

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

<style>
    body {
        font-family: 'Tajawal', sans-serif;
        background-color: #f5f7f9;
    }

    .profile-img {
        transition: transform 0.3s ease;
    }

        .profile-img:hover {
            transform: scale(1.05);
        }

    .course-card {
        transition: all 0.3s ease;
    }

        .course-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

    .badge {
        transition: transform 0.3s ease;
        cursor: pointer;
    }

        .badge:hover {
            transform: translateY(-5px);
        }

    .social-input {
        direction: ltr;
        text-align: left;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
    }

    .modal-container {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 28rem;
        overflow: hidden;
    }

    .dark .modal-container {
        background-color: #1f2937;
    }

    .modal-header {
        display: flex;
        align-items: center;
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #e5e7eb;
    }

    .dark .modal-header {
        border-bottom-color: #374151;
    }

    .modal-icon {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        margin-left: 1rem;
    }

        .modal-icon.edit {
            background-color: #e0e7ff;
            color: #4f46e5;
        }

        .modal-icon.delete {
            background-color: #fee2e2;
            color: #ef4444;
        }

    .dark .modal-icon.edit {
        background-color: #3730a3;
        color: #a5b4fc;
    }

    .dark .modal-icon.delete {
        background-color: #991b1b;
        color: #f87171;
    }

    .modal-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
    }

    .dark .modal-title {
        color: #f3f4f6;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        padding: 1rem 1.5rem;
        border-top: 1px solid #e5e7eb;
    }

    .dark .modal-footer {
        border-top-color: #374151;
    }

    .modal-btn {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
        margin-right: 0.5rem;
    }

    .modal-btn-cancel {
        background-color: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
    }

    .dark .modal-btn-cancel {
        background-color: #374151;
        color: #f3f4f6;
        border-color: #4b5563;
    }

    .modal-btn-cancel:hover {
        background-color: #e5e7eb;
    }

    .dark .modal-btn-cancel:hover {
        background-color: #4b5563;
    }

    .modal-btn-confirm {
        background-color: #2563eb;
        color: white;
        border: 1px solid #2563eb;
    }

        .modal-btn-confirm:hover {
            background-color: #1d4ed8;
        }

    .modal-btn-delete {
        background-color: #ef4444;
        color: white;
        border: 1px solid #ef4444;
    }

        .modal-btn-delete:hover {
            background-color: #dc2626;
        }

    .hidden-modal {
        display: none !important;
    }

    .tag {
        display: inline-flex;
        align-items: center;
        background-color: #e5e7eb;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        margin: 0.25rem;
    }

    .tag-remove {
        margin-right: 0.5rem;
        cursor: pointer;
        color: #6b7280;
    }

        .tag-remove:hover {
            color: #ef4444;
        }

    #map-modal .map-container {
        height: 400px;
        width: 100%;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .location-input-group {
        display: flex;
        align-items: center;
    }

        .location-input-group input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .location-input-group button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            padding: 0 12px;
        }
</style>

<div class="container mx-auto px-4 py-8">
    <!-- رأس الملف الشخصي -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-6 border-b border-gray-200 dark:border-gray-700 pb-6 mb-6">
            <div class="relative">
                <div class="relative group">
                    <img src="@(Model.ProfileImageUrl ?? "https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=400&q=80")"
                         alt="صورة المعلم"
                         class="w-32 h-32 rounded-full border-4 border-blue-500 dark:border-blue-400 object-cover profile-img"
                         id="profile-image">
                    <div class="absolute inset-0 bg-blue-500 bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer" onclick="document.getElementById('image-upload').click()">
                        <i class="fas fa-camera text-white text-2xl"></i>
                    </div>
                </div>
                <form id="image-upload-form" asp-action="UploadInstructorImage" asp-controller="Profile" method="post" enctype="multipart/form-data" class="hidden-modal">
                    <input type="file" id="image-upload" name="imageFile" accept="image/*" onchange="this.form.submit()" />
                </form>
            </div>
            <div class="flex-1">
                <div class="flex justify-between items-start">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white" id="profile-name">@Model.FullName</h1>
                        <p class="text-gray-600 dark:text-gray-300 mb-2" id="profile-title">@Model.Title</p>
                        <div class="flex items-center text-gray-600 dark:text-gray-300 mb-2">
                            <i class="fas fa-star text-yellow-500 ml-2"></i>
                            <span>4.8 تقييم (124 تقييم)</span>
                        </div>
                        <div class="flex items-center text-gray-600 dark:text-gray-300 mb-2">
                            <i class="fas fa-users text-blue-600 dark:text-blue-400 ml-2"></i>
                            <span>2,450 طالب مسجل</span>
                        </div>
                        <div class="flex items-center text-gray-600 dark:text-gray-300">
                            <i class="fas fa-book text-green-600 dark:text-green-400 ml-2"></i>
                            <span>@ViewBag.Count دورة منشورة</span>
                        </div>
                    </div>
                    <button onclick="openModal('edit-profile-modal')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors">
                        <i class="fas fa-edit ml-2"></i>
                        تعديل الملف الشخصي
                    </button>
                </div>
                <div class="flex flex-wrap gap-3 mt-4">
                    <span class="flex items-center text-gray-600 dark:text-gray-300" id="profile-location">
                        <i class="fas fa-map-marker-alt ml-2 text-blue-600 dark:text-blue-400"></i>
                        @Model.Location
                    </span>
                    <span class="flex items-center text-gray-600 dark:text-gray-300" id="profile-email">
                        <i class="fas fa-envelope ml-2 text-blue-600 dark:text-blue-400"></i>
                        @Model.Email
                    </span>
                    <span class="flex items-center text-gray-600 dark:text-gray-300" id="profile-phone">
                        <i class="fas fa-phone ml-2 text-blue-600 dark:text-blue-400"></i>
                        @Model.PhoneNumber
                    </span>
                    <span class="flex items-center text-gray-600 dark:text-gray-300">
                        <i class="fas fa-calendar-alt ml-2 text-blue-600 dark:text-blue-400"></i>
                        انضم في @Model.CreatedAt.ToString("dd MMMM yyyy", new CultureInfo("ar-EG"))
                    </span>
                </div>
            </div>
        </div>

        <!-- محتوى الملف الشخصي -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- العمود الأيسر -->
            <div class="lg:col-span-2 space-y-6">
                <!-- قسم النبذة -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">نبذة عني</h2>
                        <button onclick="openModal('edit-about-modal')" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <p class="text-gray-600 dark:text-gray-300 whitespace-pre-line break-words leading-relaxed" id="profile-about">
                        @Model.About
                    </p>
                </div>



                <!-- قسم المجالات التي أدرسها -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">المجالات التي أدرسها</h2>
                        <button onclick="openModal('edit-subjects-modal')" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <div class="flex flex-wrap" id="subjects-list">
                        @foreach (var subject in Model.Subjects)
                        {
                            <span class="tag">@subject</span>
                        }
                    </div>
                </div>

                <!-- قسم الدورات -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">دوراتي</h2>
                        <a asp-area="Instructor" asp-controller="Course" asp-action="Create" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
                            إضافة دورة جديدة
                        </a>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        @foreach (var course in Model.Courses)
                        {
                            @await Html.PartialAsync("_CourseCard", course)
                        }
                    </div>
                </div>

                <!-- قسم التقييمات -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">التقييمات (124)</h2>
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                            <div class="flex items-start mb-2">
                                <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=100&q=80" alt="صورة الطالب" class="w-10 h-10 rounded-full mr-3">
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-white">محمد أحمد</h4>
                                    <div class="flex items-center">
                                        <div class="text-yellow-500">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span class="text-sm text-gray-500 dark:text-gray-400 mr-2">منذ أسبوع</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-600 dark:text-gray-300">دورة رائعة ومحتوى غني. المعلم يشرح بطريقة مبسطة وسلسة. استفدت كثيراً وشكراً على المجهود الرائع.</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                            <div class="flex items-start mb-2">
                                <img src="https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=100&q=80" alt="صورة الطالب" class="w-10 h-10 rounded-full mr-3">
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-white">سارة محمود</h4>
                                    <div class="flex items-center">
                                        <div class="text-yellow-500">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                        </div>
                                        <span class="text-sm text-gray-500 dark:text-gray-400 mr-2">منذ 3 أيام</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-600 dark:text-gray-300">شرح ممتاز وأمثلة عملية. كان من أفضل الكورسات التي أخذتها في مجال البرمجة. أنصح الجميع به.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- العمود الأيمن -->
            <div class="space-y-6">
                <!-- قسم الإحصائيات -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">إحصائياتي</h2>
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                            <div class="bg-blue-100 dark:bg-blue-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-book text-blue-600 dark:text-blue-400 text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-800 dark:text-white">@ViewBag.Count</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">دورة منشورة</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                            <div class="bg-green-100 dark:bg-green-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-users text-green-600 dark:text-green-400 text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-800 dark:text-white">2,450</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">طالب مسجل</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                            <div class="bg-yellow-100 dark:bg-yellow-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-star text-yellow-600 dark:text-yellow-400 text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-800 dark:text-white">4.8/5</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">متوسط التقييمات</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center border border-gray-200 dark:border-gray-700">
                            <div class="bg-purple-100 dark:bg-purple-900 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-comment text-purple-600 dark:text-purple-400 text-xl"></i>
                            </div>
                            <h3 class="font-medium text-gray-800 dark:text-white">124</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">تقييم</p>
                        </div>
                    </div>
                </div>

                <!-- قسم الشهادات -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">شهاداتي</h2>
                        <button onclick="openModal('edit-certificates-modal')" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="space-y-3" id="certificates-list">
                        @foreach (var cert in Model.Certificates)
                        {
                            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h4 class="font-medium text-gray-800 dark:text-white">@cert.Name</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">@cert.Issuer - @cert.Year</p>
                                    </div>
                                    <button onclick="openDeleteCertificateModal(@cert.Id, '@cert.Name')" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- روابط التواصل -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">روابط التواصل</h2>
                        <button onclick="openModal('edit-social-modal')" class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <div class="space-y-3" id="social-links">
                        @if (!string.IsNullOrEmpty(Model.SocialLinks.GitHub))
                        {
                            <a href="@Model.SocialLinks.GitHub" class="flex items-center text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                                <i class="fab fa-github text-xl ml-3 w-6 text-center"></i>
                                @Model.SocialLinks.GitHub
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(Model.SocialLinks.LinkedIn))
                        {
                            <a href="@Model.SocialLinks.LinkedIn" class="flex items-center text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                                <i class="fab fa-linkedin text-xl ml-3 w-6 text-center"></i>
                                @Model.SocialLinks.LinkedIn
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(Model.SocialLinks.Twitter))
                        {
                            <a href="@Model.SocialLinks.Twitter" class="flex items-center text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                                <i class="fab fa-twitter text-xl ml-3 w-6 text-center"></i>
                                @Model.SocialLinks.Twitter
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(Model.SocialLinks.Facebook))
                        {
                            <a href="@Model.SocialLinks.Facebook" class="flex items-center text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                                <i class="fab fa-facebook text-xl ml-3 w-6 text-center"></i>
                                @Model.SocialLinks.Facebook
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة تعديل الملف الشخصي -->
    <div id="edit-profile-modal" class="modal-overlay hidden-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon edit">
                    <i class="fas fa-user-edit"></i>
                </div>
                <div>
                    <h3 class="modal-title">تعديل الملف الشخصي</h3>
                </div>
            </div>
            <form id="profile-form" class="modal-body">
                <input type="hidden" id="Id" name="Id" value="@Model.Id" />

                <div class="form-group">
                    <label for="FullName" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">الاسم الكامل</label>
                    <input type="text" id="FullName" name="FullName" value="@Model.FullName"
                           placeholder="مثال: محمد أحمد علي"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                              focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                </div>

                <div class="form-group">
                    <label for="Title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">المسمى الوظيفي</label>
                    <input type="text" id="Title" name="Title" value="@Model.Title"
                           placeholder="مثال: مطوّر برمجيات"
                           maxlength="100"
                           oninput="updateTitleCount(this)"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                              focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                    <div class="text-right text-sm text-gray-500 dark:text-gray-400 mt-1">
                        <span id="title-counter">0</span>
                    </div>
                </div>


                <div class="form-group">
                    <label for="Location" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">الموقع</label>
                    <div class="location-input-group">
                        <input type="text" id="Location" name="Location" value="@Model.Location"
                               placeholder="مثال: القاهرة، مصر"
                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-lg
                                  focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                        <button type="button"
                                onclick="openMapModal()"
                                style=" border-top-left-radius: 0.5rem;
                                    border-bottom-left-radius: 0.5rem;
                                    padding: 12px;
                                    margin: 4px;"
                                class="flex items-center justify-center px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded-r-lg transition-colors shadow focus:outline-none focus:ring-2 focus:ring-blue-400"
                                title="اختر الموقع على الخريطة">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="PhoneNumber" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">رقم الهاتف</label>
                    <input type="text" id="PhoneNumber" name="PhoneNumber" value="@Model.PhoneNumber"
                           placeholder="مثال: 01012345678"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                              focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>

                <div class="modal-footer">
                    <button type="button" onclick="closeModal('edit-profile-modal')" class="modal-btn modal-btn-cancel">
                        <i class="fas fa-times-circle ml-1"></i> إلغاء
                    </button>
                    <button type="button" onclick="saveProfile()" class="modal-btn modal-btn-confirm">
                        <i class="fas fa-save ml-1"></i> حفظ التغييرات
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- نافذة تعديل النبذة -->
    <div id="edit-about-modal" class="modal-overlay hidden-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon edit">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div>
                    <h3 class="modal-title">تعديل النبذة الشخصية</h3>
                </div>
            </div>
            <form id="about-form" class="modal-body">
                <input type="hidden" id="Id" name="Id" value="@Model.Id" />

                <div class="form-group">
                    <label for="About" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                        نبذة عنك
                    </label>
                    <textarea id="About" name="About" rows="5" maxlength="500"
                              placeholder="اكتب نبذة قصيرة عن خبراتك، مهاراتك، واهتماماتك..."
                              oninput="updateCharCount(this)"
                              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white
                                 transition-colors max-h-[500px] overflow-y-auto">@Model.About</textarea>
                    <div class="text-right text-sm text-gray-500 dark:text-gray-400 mt-1">
                        <span id="charCount">0 / 500</span>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" onclick="closeModal('edit-about-modal')" class="modal-btn modal-btn-cancel">
                        <i class="fas fa-times-circle ml-1"></i> إلغاء
                    </button>
                    <button type="button" onclick="saveAbout()" class="modal-btn modal-btn-confirm">
                        <i class="fas fa-save ml-1"></i> حفظ التغييرات
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- نافذة تعديل المجالات -->
    <div id="edit-subjects-modal" class="modal-overlay hidden-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon edit">
                    <i class="fas fa-book"></i>
                </div>
                <div>
                    <h3 class="modal-title">تعديل المجالات الدراسية</h3>
                </div>
            </div>
            <div class="modal-body">
                <input type="hidden" id="Id" name="Id" value="@Model.Id" />
                <div class="form-group">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">المجالات الحالية</label>
                    <div class="flex flex-wrap mb-3 p-2 border border-gray-300 dark:border-gray-600 rounded-lg" id="current-subjects">
                        @foreach (var subject in Model.Subjects)
                        {
                            <span class="tag">@subject <span class="tag-remove" onclick="removeSubject(this, '@subject')">&times;</span></span>
                        }
                    </div>
                </div>
                <div class="form-group">
                    <label for="new-subject" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">إضافة مجال جديد</label>
                    <div class="flex">
                        <input type="text" id="new-subject" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                        <button type="button" onclick="addSubject()"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 rounded-[15px] mr-[10px]">
                            إضافة
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="closeModal('edit-subjects-modal')" class="modal-btn modal-btn-cancel">
                        <i class="fas fa-times-circle ml-1"></i> إلغاء
                    </button>
                    <button type="button" onclick="saveSubjects()" class="modal-btn modal-btn-confirm">
                        <i class="fas fa-save ml-1"></i> حفظ التغييرات
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة تعديل الشهادات -->
    <div id="edit-certificates-modal" class="modal-overlay hidden-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon edit">
                    <i class="fas fa-certificate"></i>
                </div>
                <div>
                    <h3 class="modal-title">إضافة شهادة جديدة</h3>
                </div>
            </div>
            <form id="certificate-form" asp-action="AddCertificate" asp-controller="Profile" method="post" class="modal-body">
                <div class="form-group">
                    <label for="Name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">اسم الشهادة</label>
                    <input type="text" id="Name" name="Name"
                           placeholder="مثال: شهادة PMP"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                </div>
                <div class="form-group">
                    <label for="Issuer" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">الجهة المانحة</label>
                    <input type="text" id="Issuer" name="Issuer"
                           placeholder="مثال: معهد إدارة المشاريع PMI"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                </div>
                <div class="form-group">
                    <label for="Year" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">سنة الحصول</label>
                    <input type="text" id="Year" name="Year" min="1900" max="2100" maxlength="4"
                           placeholder="مثال: 2023"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                            focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>

                <div class="modal-footer">
                    <button type="button" onclick="closeModal('edit-certificates-modal')" class="modal-btn modal-btn-cancel">
                        <i class="fas fa-times-circle ml-1"></i> إلغاء
                    </button>
                    <button type="submit" class="modal-btn modal-btn-confirm">
                        <i class="fas fa-plus ml-1"></i> إضافة الشهادة
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة حذف الشهادة -->
    <div id="delete-certificate-modal" class="modal-overlay hidden-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon delete">
                    <i class="fas fa-trash-alt"></i>
                </div>
                <div>
                    <h3 class="modal-title">تأكيد حذف الشهادة</h3>
                </div>
            </div>
            <div class="modal-body">
                <p class="text-gray-600 dark:text-gray-300">هل أنت متأكد من حذف الشهادة "<span id="certificate-name"></span>"؟ هذا الإجراء لا يمكن التراجع عنه.</p>
                <form id="delete-certificate-form" asp-action="RemoveCertificate" asp-controller="Profile" method="post">
                    <input type="hidden" id="certId" name="certId" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeModal('delete-certificate-modal')" class="modal-btn modal-btn-cancel">
                    <i class="fas fa-times-circle ml-1"></i> إلغاء
                </button>
                <button type="button" onclick="deleteCertificate()" class="modal-btn modal-btn-delete">
                    <i class="fas fa-trash-alt ml-1"></i> حذف
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة تعديل روابط التواصل -->
    <div id="edit-social-modal" class="modal-overlay hidden-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-icon edit">
                    <i class="fas fa-share-alt"></i>
                </div>
                <div>
                    <h3 class="modal-title">تعديل روابط التواصل</h3>
                </div>
            </div>
            <form id="social-form" class="modal-body">
                <input type="hidden" id="Id" name="Id" value="@Model.Id" />
                <div class="space-y-3">
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 mr-10">GitHub</label>
                        <div class="flex items-center">
                            <i class="fab fa-github text-xl ml-3 w-6 text-center text-gray-600 dark:text-gray-300"></i>
                            <input type="text" name="SocialLinks.GitHub" value="@Model.SocialLinks.GitHub"
                                   placeholder="مثال: https://github.com/username"
                                   class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                      focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors social-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 mr-10">LinkedIn</label>
                        <div class="flex items-center">
                            <i class="fab fa-linkedin text-xl ml-3 w-6 text-center text-gray-600 dark:text-gray-300"></i>
                            <input type="text" name="SocialLinks.LinkedIn" value="@Model.SocialLinks.LinkedIn"
                                   placeholder="مثال: https://www.linkedin.com/in/username"
                                   class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                      focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors social-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 mr-10">Twitter</label>
                        <div class="flex items-center">
                            <i class="fab fa-twitter text-xl ml-3 w-6 text-center text-gray-600 dark:text-gray-300"></i>
                            <input type="text" name="SocialLinks.Twitter" value="@Model.SocialLinks.Twitter"
                                   placeholder="مثال: https://twitter.com/username"
                                   class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                      focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors social-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 mr-10">Facebook</label>
                        <div class="flex items-center">
                            <i class="fab fa-facebook text-xl ml-3 w-6 text-center text-gray-600 dark:text-gray-300"></i>
                            <input type="text" name="SocialLinks.Facebook" value="@Model.SocialLinks.Facebook"
                                   placeholder="مثال: https://facebook.com/username"
                                   class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                      focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors social-input">
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="margin-top:20px;">
                    <button type="button" onclick="closeModal('edit-social-modal')" class="modal-btn modal-btn-cancel">
                        <i class="fas fa-times-circle ml-1"></i> إلغاء
                    </button>
                    <button type="button" onclick="saveSocialLinks()" class="modal-btn modal-btn-confirm">
                        <i class="fas fa-save ml-1"></i> حفظ التغييرات
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- نافذة الخريطة -->
    <div id="map-modal" class="modal-overlay hidden-modal">
        <div class="modal-container" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-icon edit">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div>
                    <h3 class="modal-title">اختر موقعك على الخريطة</h3>
                </div>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <input type="text" id="map-search" placeholder="ابحث عن موقع..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors">
                </div>
                <div id="map-container" class="map-container"></div>
                <div class="flex justify-between items-center mt-4">
                    <div id="selected-location-info" class="text-gray-600 dark:text-gray-300">
                        انقر على الخريطة لاختيار موقعك
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeModal('map-modal')" class="modal-btn modal-btn-cancel">
                    <i class="fas fa-times-circle ml-[5px]"></i> إلغاء
                </button>
                <button type="button" onclick="confirmLocation()" class="modal-btn modal-btn-confirm">
                    <i class="fas fa-check-circle ml-[5px]"></i> تأكيد الموقع
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script>
    function updateCharCount(textarea) {
        const counter = document.getElementById("charCount");
        const maxLength = 500;
        counter.textContent = textarea.value.length + " / " + maxLength;
    }

    // عند تحميل الصفحة أو فتح المودال
    document.addEventListener("DOMContentLoaded", function () {
        const aboutField = document.getElementById("About");
        if (aboutField) {
            updateCharCount(aboutField);
        }
    });
       function updateTitleCount(input) {
        const counter = document.getElementById("title-counter");
        const maxLength = 100;
        counter.textContent = input.value.length + " / " + maxLength;

        // لو عدى الحد يخلي اللون أحمر
        if (input.value.length >= maxLength) {
            counter.classList.add("text-red-500");
        } else {
            counter.classList.remove("text-red-500");
        }
    }

    // تحميل أولي
    document.addEventListener("DOMContentLoaded", function () {
        const titleField = document.getElementById("Title");
        if (titleField) {
            updateTitleCount(titleField);
        }
    });
    // وظائف النوافذ المنبثقة
    function openModal(id) {
        document.getElementById(id).classList.remove('hidden-modal');
        document.body.style.overflow = 'hidden';
    }

    function closeModal(id) {
        document.getElementById(id).classList.add('hidden-modal');
        document.body.style.overflow = 'auto';
    }

    // إغلاق النافذة عند النقر خارجها
    document.addEventListener('click', function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            closeModal(event.target.id);
        }
    });

    // إغلاق النافذة عند الضغط على مفتاح Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const openModals = document.querySelectorAll('.modal-overlay:not(.hidden-modal)');
            openModals.forEach(modal => {
                closeModal(modal.id);
            });
        }
    });

    // متغيرات الخريطة
    let map;
    let marker;
    let selectedLocation = null;

    // فتح نافذة الخريطة
    function openMapModal() {
        openModal('map-modal');
        setTimeout(initMap, 100);
    }

    // تهيئة الخريطة
    function initMap() {
        if (map) {
            map.remove();
        }

        map = L.map('map-container').setView([24.7136, 46.6753], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        map.on('click', function(e) {
            selectedLocation = e.latlng;
            updateMarker();
            reverseGeocode(selectedLocation.lat, selectedLocation.lng);
        });

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    map.setView(userLocation, 13);
                    selectedLocation = userLocation;
                    updateMarker();
                    reverseGeocode(userLocation.lat, userLocation.lng);
                },
                function(error) {
                    console.log("لم يتمكن من الحصول على الموقع الحالي:", error);
                }
            );
        }

        document.getElementById('map-search').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchLocation(this.value);
            }
        });
    }

    // تحديث العلامة على الخريطة
    function updateMarker() {
        if (marker) {
            map.removeLayer(marker);
        }
        marker = L.marker(selectedLocation).addTo(map)
            .bindPopup('الموقع المحدد').openPopup();
    }

    // البحث عن موقع
    function searchLocation(query) {
        if (!query) return;

        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&accept-language=ar`)
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    const location = data[0];
                    selectedLocation = {
                        lat: parseFloat(location.lat),
                        lng: parseFloat(location.lon)
                    };
                    map.setView(selectedLocation, 13);
                    updateMarker();
                    document.getElementById('selected-location-info').textContent = location.display_name;
                } else {
                    alert('لم يتم العثور على الموقع');
                }
            })
            .catch(error => {
                console.error('خطأ في البحث:', error);
            });
    }

    // تحويل الإحداثيات إلى عنوان
    function reverseGeocode(lat, lng) {
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`)
            .then(response => response.json())
            .then(data => {
                if (data && data.display_name) {
                    document.getElementById('selected-location-info').textContent = data.display_name;
                }
            })
            .catch(error => {
                console.error('خطأ في reverse geocoding:', error);
            });
    }

    // تأكيد اختيار الموقع
    function confirmLocation() {
        if (selectedLocation) {
            const locationText = document.getElementById('selected-location-info').textContent;
            document.getElementById('Location').value = locationText.includes('انقر على الخريطة')
                ? `${selectedLocation.lat.toFixed(4)}, ${selectedLocation.lng.toFixed(4)}`
                : locationText;

            closeModal('map-modal');
        } else {
            alert('يرجى اختيار موقع على الخريطة أولاً');
        }
    }

    // حفظ الملف الشخصي
    function saveProfile() {
        const formData = new FormData(document.getElementById('profile-form'));
        fetch('@Url.Action("UpdateInstructorProfile", "Profile", new { area = "Learner" })', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('فشل في حفظ التغييرات');
            }
        }).catch(error => {
            alert('خطأ: ' + error);
        });
        closeModal('edit-profile-modal');
    }

    // حفظ النبذة
    function saveAbout() {
        const formData = new FormData(document.getElementById('about-form'));
        fetch('@Url.Action("UpdateInstructorProfile", "Profile", new { area = "Learner" })', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('فشل في حفظ التغييرات');
            }
        }).catch(error => {
            alert('خطأ: ' + error);
        });
        closeModal('edit-about-modal');
    }

    // إضافة مجال جديد (محلياً في المودال)
    function addSubject() {
        const newSubjectInput = document.getElementById('new-subject');
        const subject = newSubjectInput.value.trim();

        if (subject) {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.innerHTML = `${subject} <span class="tag-remove" onclick="removeSubject(this, '${subject}')">&times;</span>`;
            document.getElementById('current-subjects').appendChild(tag);
            newSubjectInput.value = '';
        }
    }

    // إزالة مجال مع تحديث فوري
    function removeSubject(element, subject) {
        element.parentElement.remove();
    }


    // حفظ المجالات
    function saveSubjects() {
        const tags = document.querySelectorAll('#current-subjects .tag');
        const subjects = Array.from(tags).map(tag => tag.textContent.trim().replace('×', ''));
        const formData = new FormData();
        formData.append('Id', document.querySelector('#edit-subjects-modal input[name="Id"]').value);
        subjects.forEach((subject, index) => {
            formData.append(`Subjects[${index}]`, subject);
        });

        fetch('@Url.Action("UpdateInstructorProfile", "Profile", new { area = "Learner" })', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('فشل في حفظ التغييرات');
            }
        }).catch(error => {
            alert('خطأ: ' + error);
        });
        closeModal('edit-subjects-modal');
    }

    // حفظ روابط التواصل
    function saveSocialLinks() {
        const formData = new FormData(document.getElementById('social-form'));
        fetch('@Url.Action("UpdateInstructorProfile", "Profile", new { area = "Learner" })', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('فشل في حفظ التغييرات');
            }
        }).catch(error => {
            alert('خطأ: ' + error);
        });
        closeModal('edit-social-modal');
    }

    // فتح نافذة حذف الشهادة
    function openDeleteCertificateModal(certId, certName) {
        document.getElementById('certificate-name').textContent = certName;
        document.getElementById('certId').value = certId;
        openModal('delete-certificate-modal');
    }

    // حذف الشهادة
    function deleteCertificate() {
        const formData = new FormData(document.getElementById('delete-certificate-form'));
        fetch('@Url.Action("RemoveCertificate", "Profile", new { area = "Learner" })', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('فشل في حذف الشهادة');
            }
        }).catch(error => {
            alert('خطأ: ' + error);
        });
        closeModal('delete-certificate-modal');
    }
</script>